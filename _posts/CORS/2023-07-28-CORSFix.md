---
title: "TIL: has been blocked by CORS policy"
toc: true
toc_sticky: true
categories:
  - 설명
tags:
  - [PHP, CORS, 해결]
last_modified_at: 2023-07-28
---
![CORSPolicy](https://github.com/MOJAN3543/MOJAN3543.github.io/blob/main/_posts/CORS/CORSPolicy.jpg?raw=true "CORSPolicySameOrigin")
{: .text-center}  
엥???
## 1. 발단
저는 2023년도 2학기 복학 예정입니다. 그래서 2학기에 들을 수업들을 수강 신청해야 되는데, 저는 그동안 학교에서 짜준 수업대로 듣고 살았기 때문에, 이번 수강 신청이 처음입니다...  
  
그래서 누구보다도 수강신청에 숙달되기 위해 수강신청 연습 사이트를 만들기로 했습니다. 프론트 엔드로 웹 사이트를 제작하던 중, 수업 정보에 대한 API가 있으면 정보를 입력하기에 용이하다고 생각해서, 학교에서 사용되는 API를 사용하기로 합니다[^1].
```
{% raw %}fetch(SchoolURL);{% endraw %}
```
구글링 해서 위와 같은 코드가 API의 값을 불러오는데 사용된다고 알게 되었습니다. 이를 이용하면 쉽게 마무리 지을수 있다고 생각하던 찰나, 다음과 같은 에러 메세지를 만나게 됩니다.
```
{% raw %}Access to fetch at 'http://mojanapi.dothome.co.kr/API.php' from origin 'http://ide.goorm.io' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.{% endraw %}
```
어... CORS policy?  

## 2. Cross-Origin Resource Sharing
CORS. 교차 출처 리소스 공유라는 뜻을 가진 이 정책은 서로 다른 도메인에 있는 웹 사이트(혹은 서버)의 리소스를 요청할때 관여하는 브라우저 정책중 일부입니다.  
  
![SameOrigin](https://github.com/MOJAN3543/MOJAN3543.github.io/blob/main/_posts/CORS/SameOrigin.png?raw=true "SameOrigin")
{: .text-center}  
예를 들겠습니다. `mojan3543.github.io`에서 `mojan3543.github.io`의 API를 불러오고자 합니다. 이는 전혀 무리 없이 동작합니다. 왜냐하면 이 두 웹사이트는 동일한 도메인에 있는 웹사이트이므로, SOP(Same-Origin-Policy)를 따르기 때문에, 리소스를 요청하는데에 아무런 제약을 받지 않습니다[^2].  
   
![CrossOrigin](https://github.com/MOJAN3543/MOJAN3543.github.io/blob/main/_posts/CORS/CrossOrigin.png?raw=true "CrossOrigin")
{: .text-center}  
하지만, 위와 같이 서로 다른 도메인을 가진 웹 사이트에서 리소스를 요청하는 경우에는 COP(Cross-Origin-Policy)를 따르게 되어, 제가 겪었던 것 처럼 CORS 정책을 위반했다고 에러 메세지가 발생할 겁니다.  
   
같은 도메인이 아니면 리소스를 허용하지 않는 이 괴상한 쇄국정책[^3]은 사실 사용자의 보안을 위해 만들어졌습니다. [**XSS**](https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85)나 [**CSRF**](https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%9A%94%EC%B2%AD_%EC%9C%84%EC%A1%B0)와 같이, 원하지 않는 웹사이트, 스크립트를 공격 목적으로 강제로 실행시키는 취약점을 막습니다.

하지만, 저처럼 초보 웹 개발자들의 발목을 잡는 주 원인이기도 합니다. 이럴때는 어떻게 해결을 해야될까요?  

### 2.1. 해결법
CORS 정책 위반을 해결하기 위한 해결법은 대략 3가지가 있습니다.

1. 서버의 헤더 설정을 변경한다 : 리소스를 호출하는 서버의 헤더 설정을 변경하는 방법입니다. 친절하게도 CORS 에러 메세지에는 'Access-Control-Allow-Origin' 헤더가 없다고 알려줍니다. 이를 백엔드 서버의 언어에 맞는 헤더를 추가해주면 간단하게 해결됩니다.
2. 프록시 서버를 사용한다 : 만약에 서버의 헤더를 변경할 수 없는 상황이라면, 서버의 응답을 대신 받아서 다시 보내주는 프록시 서버를 이용하면 됩니다[^4]. 실제로 서버를 구축하거나, CORS 우회용 서비스 서버를 구독하여 사용합니다.
3. CORS 정책 우회용 프로그램을 설치한다 : 모든 CORS 에러의 근원은 클라이언트인 브라우저이므로, 브라우저의 설정을 [**약간**](https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf) 변경하는것만으로 해결이 됩니다! 물론, 클라이언트에서 해결을 했으므로, 전문 용어로 `It works on my machine ¯\_(ツ)_/¯`을 시전해야 합니다...

## 3. 내가 선택한 해결법
제가 선택 할 수 있는건 2가지 입니다. 프록시 서버를 사용하거나, CORS 정책 우회용 프로그램을 설치하는 것인데, 후자의 경우에는 제가 만든 사이트를 저만 사용해야 하는 단점이 있으므로, 이김에 프록시 서버를 직접 만들어 보여 0이었던 백앤드 경험치를 올려보고자, 프록시 서버를 구축하기로 결심합니다.

[^1]: 웹 크롤링에 오픈 API가 아닌, 개발자 도구를 통해 알아낸 비공식 API를 사용하는것에 대한 논란이 많습니다. 특히 [여기어때가 경쟁 업체인 야놀자의 데이터베이스를 무단 크롤링](https://www.etnews.com/20200211000365)을 하고, 이 무단 크롤링이 위법이라는 판결을 받게 되면서, 크롤링이 불법으로 인식 되는 경우가 더러 있습니다. 하지만, 비 상업적으로 이용하거나, 서버에 과한 부하를 주지 않는 한에서는 허용되는 분위기로 남아 있습니다.
[^2]: 단, [**폰트는 예외입니다.**](https://stackoverflow.com/questions/33197751/fonts-are-blocked-in-web-client-cors)
[^3]: 여기서 궁금증이 들 수 있습니다. 이렇게 모든 리소스를 차단하면 어떻게 인터넷이 유지가 되었을까? 사실은 모든 리소스를 차단하지는 않습니다. CORS 정책은 인증 되지 않은 [**Ajax**](https://ko.wikipedia.org/wiki/Ajax)을 철저하게 차단하고, 그 외 인증된 Ajax, 이미지, 스타일 시트, 동영상 등은 자유롭게 호출하고 응답할 수 있습니다.
[^4]: 여기서 또 궁금증이 들 수 있습니다. 어차피 프록시 서버에서 불러오는 때에도 서로 다른 도메인에서 리소스 요청을 하기 때문에, CORS 정책을 위반 하는건 아닌가? 아닙니다. CORS 정책은 브라우저에 한하여 적용되고 있습니다. 그러므로 브라우저에서 CORS 에러가 발생해도, 데이터는 정상적으로 응답합니다! 브라우저 단에서 응답 온 데이터를 차단해서 문제입니다.
